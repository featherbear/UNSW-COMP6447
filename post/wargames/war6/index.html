<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Wargames 6 - COMP6447 Musings</title><meta name=renderer content=webkit><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content=no-transform><meta http-equiv=cache-control content=no-siteapp><meta name=theme-color content=#f8f5ec><meta name=msapplication-navbutton-color content=#f8f5ec><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=#f8f5ec><meta name=author content=z5206677><meta name=description content="swrop [Binary]"><meta name=keywords content=Hugo,theme,even><meta name=generator content="Hugo 0.58.2 with theme even"><link rel=canonical href=../../../post/wargames/war6/><link rel=apple-touch-icon sizes=180x180 href=../../../apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=../../../favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=../../../favicon-16x16.png><link rel=manifest href=../../../manifest.json><link rel=mask-icon href=../../../safari-pinned-tab.svg color=#5bbad5><link href=../../../dist/even.c2a46f00.min.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><link rel=stylesheet href=../../../css/typedjs.shortcode.css><meta property=og:title content="Wargames 6"><meta property=og:description content="swrop [Binary]"><meta property=og:type content=article><meta property=og:url content=/post/wargames/war6/><meta property=article:published_time content=2020-07-19T12:00:00+10:00><meta property=article:modified_time content=2020-07-19T12:00:00+10:00><meta itemprop=name content="Wargames 6"><meta itemprop=description content="swrop [Binary]"><meta itemprop=datePublished content=2020-07-19T12:00:00&#43;10:00><meta itemprop=dateModified content=2020-07-19T12:00:00&#43;10:00><meta itemprop=wordCount content=565><meta itemprop=keywords content><meta name=twitter:card content=summary><meta name=twitter:title content="Wargames 6"><meta name=twitter:description content="swrop [Binary]"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=../../../ class=logo>COMP6447 Musings</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=../../../><li class=mobile-menu-item>Home</li></a><a href=https://github.com/featherbear/UNSW-COMP6447><li class=mobile-menu-item>GitHub</li></a><a href=../../../categories/><li class=mobile-menu-item>Categories</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=../../../ class=logo>COMP6447 Musings</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=../../../>Home</a></li><li class=menu-item><a class=menu-item-link href=https://github.com/featherbear/UNSW-COMP6447>GitHub</a></li><li class=menu-item><a class=menu-item-link href=../../../categories/>Categories</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Wargames 6</h1><div class=post-meta><span class=post-time>2020-07-19</span><div class=post-category><a href=../../../categories/wargames/>Wargames</a></div></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><ul><li><a href=#swrop>swrop</a><ul><li><a href=#scenario>Scenario</a></li><li><a href=#solution>Solution</a></li></ul></li><li><a href=#static>static</a><ul><li><a href=#scenario-1>Scenario</a></li><li><a href=#solution-1>Solution</a></li></ul></li><li><a href=#roproprop>roproprop</a><ul><li><a href=#scenario-2>Scenario</a></li><li><a href=#solution-2>Solution</a></li></ul></li><li><a href=#ropme>ropme</a><ul><li><a href=#scenario-3>Scenario</a></li><li><a href=#solution-3>Solution</a></li></ul></li><li><a href=#reversing-challenge>Reversing Challenge</a></li></ul></li></ul></nav></div></div><div class=post-content><h2 id=swrop>swrop</h2><p>[<a href=https://github.com/featherbear/UNSW-COMP6447/raw/master/wargames/week7/swrop>Binary</a>]<br>[<a href=https://github.com/featherbear/UNSW-COMP6447/raw/master/wargames/week7/solve-swrop.py>Solution</a>]</p><h3 id=scenario>Scenario</h3><p>The program contains a <code>read()</code> function that is vulnerable to a buffer overflow attack. The program also contains a <code>system()</code> function and <code>&quot;/bin/sh&quot;</code> string</p><h3 id=solution>Solution</h3><p>As PIE is disabled, the address of <code>system()</code> (or a call to system) can be found through static analysis. We can overflow the return address of the <code>vulnerable_function</code> function, and push the <code>&quot;/bin/sh&quot;</code> string address onto the stack to exploit.</p><hr><h2 id=static>static</h2><p>[<a href=https://github.com/featherbear/UNSW-COMP6447/raw/master/wargames/week7/static>Binary</a>]<br>[<a href=https://github.com/featherbear/UNSW-COMP6447/raw/master/wargames/week7/solve-static.py>Solution</a>]</p><h3 id=scenario-1>Scenario</h3><p>The program contains a whole lot of library functions (embedded rather than linked). It has a vulnerable <code>gets()</code> function which allows us to overwrite the return address. There is no <code>&quot;/bin/sh&quot;</code> string within the binary.</p><h3 id=solution-1>Solution</h3><p>The <code>0x080a8cb6: pop eax; ret;</code> instruction does not work as it contains an <code>0x0a</code> byte (newline character) - which will cause <code>gets()</code> to finish reading. To work around this problem, we can <code>pop edx</code>, then <code>mov eax, edx</code>.</p><p>The <code>0x0806ee5b: push eax; adc al, 0x7c; and dword ptr [esi + 0x1a], edi; pop ebx; ret;</code> instruction can get around this <code>gets()</code> newline limitation, but&hellip; nah.</p><p>As there is no <code>&quot;/bin/sh&quot;</code> string, we will need to load it into the memory through a series of <code>pop ...</code> and <code>mov [...], ...</code> instructions.</p><p>The registers can then be modified to launch an <code>execve</code> syscall.</p><hr><h2 id=roproprop>roproprop</h2><p>[<a href=https://github.com/featherbear/UNSW-COMP6447/raw/master/wargames/week7/roproprop>Binary</a>]<br>[<a href=https://github.com/featherbear/UNSW-COMP6447/raw/master/wargames/week7/solve-roproprop.py>Solution</a>]</p><h3 id=scenario-2>Scenario</h3><p>The program has PIE enabled, meaning that an address leak is required to calculate offsets in the program. Libc is linked to this binary, so functions and gadgets can be found from the libc library.</p><h3 id=solution-2>Solution</h3><p>The the address of <code>setbuf</code> is given, which has an offset of <code>0x65ff0</code> from the libc base. This allows us to calculate the runtime address of the <code>system()</code> function, as well as the runtime address of the <code>&quot;/bin/sh&quot;</code> string.</p><hr><h2 id=ropme>ropme</h2><p>[<a href=https://github.com/featherbear/UNSW-COMP6447/raw/master/wargames/week7/ropme>Binary</a>]<br>[<a href=https://github.com/featherbear/UNSW-COMP6447/raw/master/wargames/week7/solve-ropme.py>Solution</a>]</p><h3 id=scenario-3>Scenario</h3><p>The binary has a vulnerable <code>fgets()</code> function; however there are few gadgets that were found which would allow us to create an <code>execve(&quot;/bin/sh&quot;, ...)</code> call. There are also few gadgets which allow us to easily manipulate the <code>eax</code>, <code>ecx</code> and <code>edx</code> registers. The flag file is however opened at <code>fd 3</code>&hellip;</p><h3 id=solution-3>Solution</h3><p>Using the <code>read</code> and <code>write</code> syscalls, we can write from the flag (<code>fd 3</code>) into a buffer located at <code>ecx</code>. Thankfully <code>ecx</code> contains the buffer used in and returned from <code>fgets()</code>. The flag can then be written out from the buffer to <code>stdout</code> (<code>fd 1</code>).</p><hr><h2 id=reversing-challenge>Reversing Challenge</h2><p>[<a href=https://github.com/featherbear/UNSW-COMP6447/raw/master/wargames/week7/re.png>Disassembly</a>]<br>[<a href=https://github.com/featherbear/UNSW-COMP6447/raw/master/wargames/week7/re.c>Solution</a>]</p><p>The disassembly shows a function that performs a number of memory allocation, and modifications to that memory. If a memory allocation fails, the program exits with a status code of <code>1</code>.</p><p>A struct is supposedly defined to have a <code>char</code> value and a pointer to another node (linked list!). Each time a new struct is defined, it is made the &lsquo;head&rsquo; of the list, and the previous head is attached to the node. The 10 nodes are assigned a data value from &lsquo;A&rsquo; to &lsquo;J&rsquo; respectively.</p><p>The program seems to have a bug, which causes the nodes in the list to unlink themselves (<code>mov dword ptr [eax + 4], 0</code>).<br>This is likely Adam&rsquo;s fault :) and can be fixed by making the change in the below source code</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code class=language-c data-lang=c><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-c data-lang=c><span class=cp># OLD
</span><span class=cp></span><span class=n>node</span><span class=o>-&gt;</span><span class=n>next</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
<span class=o>---</span>
<span class=cp># NEW
</span><span class=cp></span><span class=n>node</span><span class=o>-&gt;</span><span class=n>value</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span></code></pre></td></tr></table></div></div><p>Alternatively, the statement can be removed as it is reassigned immediately after.</p><p>At the end of the loop, the head of the list is returned.</p></div><footer class=post-footer><nav class=post-nav><a class=prev href=../../../post/return-oriented-programming/><i class="iconfont icon-left"></i><span class="prev-text nav-default">Return Oriented Programming</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=../../../post/tutorials/tutorial7/><span class="next-text nav-default">Tutorial 7</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:z5206677@student.unsw.edu.au class="iconfont icon-email" title=email></a><a href=https://www.linkedin.com/in/andrewjinmengwong/ class="iconfont icon-linkedin" title=linkedin></a><a href=https://github.com/featherbear class="iconfont icon-github" title=github></a><a href=https://www.instagram.com/_andrewjwong/ class="iconfont icon-instagram" title=instagram></a><a href=../../../index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span class=theme-info>Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span>
<span class=copyright-year>&copy;
2020
<span class=heart><i class="iconfont icon-heart"></i></span><span class=author>Andrew Wong (z5206677)</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script><script type=text/javascript src=../../../dist/even.26188efa.min.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-107434487-2','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=../../../js/typed.js@2.0.9></script><script src=../../../js/typedjs.shortcode.js></script></body></html>